@use "pico";
@use "settings" as *;

@use "sass:map";

// From github.com/Yohn/PicoCSS

#{$parent-selector} nav[role="navigation"] {
    z-index: 1;
    //align-items: center; // the label for the burger was bouncing
    width: 100%;
    overflow: visible;

    &[data-position="start"] {
        /* remove the 'flex-direction' to move menu to the right */
        flex-direction: row-reverse;
    }

    > input[type="checkbox"] {
        display: none;
        user-select: none;
    }

    > label {
        display: none;
        cursor: pointer;
        user-select: none;
    }

    > ul,
    > ol {
        > li > [role="search"] {
            margin-block-end: 0;
        }
    }
}

@each $breakpoint, $values in $breakpoints {
    $databp: 'nav[role="navigation"]';

    @if $breakpoint != sm {
        $databp: #{$databp} + "[data-breakpoint='" + $breakpoint + "']";
    }

    $viewport: map.get($values, "viewport");

    @media (max-width: $viewport) {
        #{$parent-selector} #{$databp} {
            flex-wrap: wrap;
            overflow: hidden;

            &:has(input[type="checkbox"]:checked) {
                overflow: visible;
            }

            label {
                display: block;
            }

            > [role="list"] {
                display: none;
                flex-direction: column;
                align-items: flex-start;
                width: 90vw;
                max-height: 0;
                margin: 0 auto;
                background-color: var(#{$css-var-prefix}muted-border-color); //muted-border-color);
                box-shadow: var(#{$css-var-prefix}box-shadow);
                opacity: 0;

                @if $enable-transitions {
                    transition: max-height var(#{$css-var-prefix}transition), opacity var(#{$css-var-prefix}transition);
                }

                li {
                    width: calc(100% - calc(var(#{$css-var-prefix}nav-link-spacing-vertical) * 2));
                    margin: calc(var(#{$css-var-prefix}nav-link-spacing-vertical) * 0.5) var(#{$css-var-prefix}nav-link-spacing-vertical);
                    padding: 0;

                    > details.dropdown {
                        width: 100%;
                    }

                    > form[role="search"] {
                        margin-block-end: 0;
                    }
                }

                a {
                    display: block;
                    margin: 0;
                    border-radius: 0;
                    border-block-end: 1px solid transparent;

                    @if $enable-transitions {
                        transition: border-color var(#{$css-var-prefix}transition), color var(#{$css-var-prefix}transition);
                    }
                }

                a:hover {
                    border-bottom-color: var(#{$css-var-prefix}underline);
                    text-decoration: none;
                    //background-color: var(#{$css-var-prefix}primary-background) !important;
                    //color: var(#{$css-var-prefix}primary-inverse);
                }
            }

            input[type="checkbox"]:checked ~ [role="list"] {
                display: block;
                max-height: 100vh;
                opacity: 1;
            }
        }
    }
}

// Own code begins here

#hamburger-btn ~ label {
    padding: var(--pico-nav-element-spacing-vertical) var(--pico-nav-element-spacing-horizontal);
    margin-right: calc(var(--pico-nav-element-spacing-horizontal) * -1);

    svg {
        transition: transform var(--pico-transition);
        width: 2em;
        height: 100%;
    }
}

#hamburger-btn:checked ~ label {
    svg {
        transform: rotate(90deg);
    }
}

nav[role=navigation] > [role=list] {
    background-color: transparent;
}

@media (max-width: map.get(map.get(pico.$breakpoints, "sm"), "viewport")) {
    nav[role=navigation] {
        position: sticky;
        top: 0;
        background-color: var(--pico-background-color);
        border-bottom: 1px solid var(--pico-muted-border-color);
        box-shadow: var(--pico-card-box-shadow);

        #hamburger-btn ~ [role=list] {
            flex-direction: column-reverse;
            transition: max-height var(#{$css-var-prefix}transition), opacity var(#{$css-var-prefix}transition), display var(#{$css-var-prefix}transition);
            transition-behavior: allow-discrete;

            @starting-style {
                max-height: 0;
                opacity: 0;
            }

            a {
                &[role=button] {
                    display: block;
                    margin: var(--pico-nav-element-spacing-vertical) var(--pico-nav-element-spacing-horizontal);
                }

                border-radius: var(--pico-border-radius);
                border-block-end: 1px solid transparent;
                transition: revert;

                &:hover {
                    border-bottom-color: transparent;
                }
            }
        }

        #hamburger-btn:checked ~ [role=list] {
            display: flex;
        }

        details.dropdown > summary + ul {
            pointer-events: none;
            position: relative;
            transform: scaleY(0);
            opacity: 0;

            li {
                margin: 0;

                &:first-of-type {
                    margin-block-start: calc(var(--pico-form-element-spacing-vertical) * 0.5);
                }

                &:last-of-type {
                    margin-block-end: calc(var(--pico-form-element-spacing-vertical) * 0.5);
                    padding: calc(var(--pico-form-element-spacing-vertical)) var(--pico-form-element-spacing-horizontal);
                }
            }

            a, button {
                display: block;
                padding: calc(var(--pico-form-element-spacing-vertical)) var(--pico-form-element-spacing-horizontal);
            }

            button {
                //margin: calc(var(--pico-form-element-spacing-vertical) * 0.5) var(--pico-form-element-spacing-horizontal);
            }
        }

        details.dropdown[open] > summary + ul {
            pointer-events: auto;
            transform: scaleY(1);
            opacity: 1;
        }

        details.dropdown[open] > summary::before {
            display: none;
        }
    }
}

