<div class="chat-island">
    <div class="chat-status" aria-live="polite">
        @if (_status == ConnectionStatus.Connected)
        {
            <span>Połączono</span>
        }
        else
        {
            <span>@_status</span>
        }
    </div>

    <ul id="chat-history" class="chat-history" aria-live="polite" @ref="_historyRef">
        @foreach (var msg in _messages)
        {
            <li class="msg @(msg.UserId == CurrentUserId ? "self" : "other")" data-id="@msg.Id">
                <div class="bubble">
                    <header class="meta">
                        <span class="user">@msg.UserDisplayName</span>
                        <time datetime="@msg.CreatedUtc.ToString("O")">@msg.CreatedUtc.ToLocalTime().ToString("HH:mm")</time>
                    </header>
                    <p class="content">@msg.Content</p>
                </div>
            </li>
        }
    </ul>

    <div class="chat-input">
        <label for="chatDraft">Wiadomość</label>
        <textarea id="chatDraft"
                  @ref="_inputRef"
                  @bind="_draft"
                  @bind:event="oninput"
                  @onkeydown="HandleKey"
                  maxlength="500"
                  rows="3"
                  aria-label="Wiadomość do wysłania"></textarea>
        <button type="button"
                @onclick="SendAsync"
                disabled="@(!_canSend)"
                aria-disabled="@(!_canSend)">Wyślij</button>
    </div>
</div>
